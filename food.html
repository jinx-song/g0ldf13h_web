<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Food — Goldfish</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,opsz,wght@0,9..40,400;0,9..40,500;0,9..40,600;1,9..40,400&family=Fraunces:opsz,wght@9..144,500;9..144,600;9..144,700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="styles.css">
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
    crossorigin=""
  />
</head>
<body class="food-page">
  <main class="page">
    <header class="page-header">
      <a href="index.html" class="back-link">← Back home</a>
      <h1>Food</h1>
      <p class="lead">Recipes, restaurants, and culinary stories.</p>
    </header>
    <div class="page-content">
      <p>Explore our food section for recipes, restaurant guides, and stories from the table.</p>

      <h2>Goldfish restaurant map</h2>
      <p>This interactive map is populated directly from our shared <a href="https://docs.google.com/spreadsheets/d/1-1samCRAdvP9G9tHhA3aOvJVfPgI6yLpfI6aRMigQzc/edit?gid=0#gid=0" target="_blank" rel="noreferrer">restaurant spreadsheet</a>.</p>

      <div id="food-map" aria-label="Map of restaurants mentioned in Goldfish spreadsheet"></div>
    </div>
  </main>
  <script
    src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
    crossorigin=""
  ></script>
  <script>
    (function () {
      const SHEET_CSV_URL =
        "https://docs.google.com/spreadsheets/d/1-1samCRAdvP9G9tHhA3aOvJVfPgI6yLpfI6aRMigQzc/export?format=csv&gid=0";

      const cityCoords = {
        "USA|Seattle": [47.6062, -122.3321],
        "USA|Boston": [42.3601, -71.0589],
        "USA|Milwaukee": [43.0389, -87.9065],
        "USA|Bellevue": [47.6101, -122.2015],
      };

      const map = L.map("food-map", {
        scrollWheelZoom: false,
      }).setView([42.5, -95], 3.5);

      L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
        maxZoom: 19,
        attribution: "&copy; OpenStreetMap contributors",
      }).addTo(map);

      function parseCsv(csv) {
        const lines = csv.trim().split(/\r?\n/);
        if (!lines.length) return [];
        const rows = [];
        for (let i = 1; i < lines.length; i++) {
          const line = lines[i].trim();
          if (!line) continue;
          const cols = line.split(",");
          const [name, country, city] = cols.map((c) => c.trim());
          if (!name) continue;
          rows.push({ name, country, city });
        }
        return rows;
      }

      async function loadRestaurants() {
        try {
          const res = await fetch(SHEET_CSV_URL);
          if (!res.ok) throw new Error("Unable to load spreadsheet");
          const text = await res.text();
          const rows = parseCsv(text);

          const bounds = [];

          rows.forEach((row) => {
            const key = (row.country || "") + "|" + (row.city || "");
            const coords = cityCoords[key];
            if (!coords) return;
            const marker = L.marker(coords).addTo(map);
            marker.bindPopup(
              "<strong>" +
                row.name +
                "</strong><br>" +
                [row.city, row.country].filter(Boolean).join(", ")
            );
            bounds.push(coords);
          });

          if (bounds.length) {
            map.fitBounds(bounds, { padding: [32, 32] });
          }
        } catch (err) {
          console.error(err);
        }
      }

      loadRestaurants();
    })();
  </script>
</body>
</html>
